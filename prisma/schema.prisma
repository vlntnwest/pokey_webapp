generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  schemas  = ["public"]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// Note: id references auth.users(id) via SQL constraint (managed by Supabase, not Prisma)
model User {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email             String?            @unique
  fullName          String?            @map("full_name") @db.VarChar(50)
  phone             String?
  createdAt         DateTime?          @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?          @map("updated_at") @db.Timestamp(6)
  restaurantMembers RestaurantMember[]

  @@map("users")
  @@schema("public")
}

model Restaurant {
  id                String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name              String             @db.VarChar(255)
  address           String             @db.Text
  zipCode           String             @db.VarChar(5)
  city              String             @db.VarChar(50)
  phone             String?
  email             String?
  imageUrl          String?            @map("image_url")
  createdAt         DateTime?          @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?          @map("updated_at") @db.Timestamp(6)
  openingHours      OpeningHour[]
  categories        Category[]
  products          Product[]
  orders            Order[]
  restaurantMembers RestaurantMember[]

  @@map("restaurants")
  @@schema("public")
}

model RestaurantMember {
  id           String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  restaurantId String         @map("restaurant_id") @db.Uuid
  userId       String         @map("user_id") @db.Uuid
  role         RestaurantRole
  createdAt    DateTime?      @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime?      @map("updated_at") @db.Timestamp(6)

  restaurant Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([restaurantId, userId])
  @@map("restaurant_members")
  @@schema("public")
}

model OpeningHour {
  id           String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  restaurantId String     @map("restaurant_id") @db.Uuid
  dayOfWeek    Int        @map("day_of_week")
  openTime     String     @map("open_time")
  closeTime    String     @map("close_time")
  order        Int
  createdAt    DateTime?  @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt    DateTime?  @map("updated_at") @db.Timestamp(6)
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([restaurantId])
  @@map("opening_hours")
  @@schema("public")
}

model Category {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  restaurantId      String            @map("restaurant_id") @db.Uuid
  name              String            @db.VarChar(255)
  subHeading        String?           @map("sub_heading") @db.Text
  displayOrder      Int               @map("display_order")
  createdAt         DateTime?         @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?         @map("updated_at") @db.Timestamp(6)
  restaurant        Restaurant        @relation(fields: [restaurantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  productCategories ProductCategory[]

  @@index([restaurantId])
  @@map("categories")
  @@schema("public")
}

model Product {
  id                String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  restaurantId      String            @map("restaurant_id") @db.Uuid
  name              String            @db.VarChar(50)
  description       String?           @db.VarChar(255)
  imageUrl          String?           @map("image_url")
  price             Decimal           @db.Decimal(10, 2)
  tags              String[]
  discount          Decimal?          @default(0) @db.Decimal(10, 2)
  isAvailable       Boolean           @default(true) @map("is_available")
  displayOrder      Int               @map("display_order")
  createdAt         DateTime?         @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime?         @map("updated_at") @db.Timestamp(6)
  restaurant        Restaurant        @relation(fields: [restaurantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  productCategories ProductCategory[]
  optionGroups      OptionGroup[]
  orderProducts     OrderProduct[]

  @@index([restaurantId])
  @@map("products")
  @@schema("public")
}

model ProductCategory {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId  String    @map("product_id") @db.Uuid
  categoryId String    @map("category_id") @db.Uuid
  createdAt  DateTime? @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime? @map("updated_at") @db.Timestamp(6)
  product    Product   @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  category   Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([productId, categoryId])
  @@map("products_categories")
  @@schema("public")
}

model OptionGroup {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  productId     String         @map("product_id") @db.Uuid
  name          String         @db.VarChar(255)
  hasMultiple   Boolean        @default(false) @map("has_multiple")
  isRequired    Boolean        @default(true) @map("is_required")
  minQuantity   Int            @map("min_quantity")
  maxQuantity   Int            @map("max_quantity")
  createdAt     DateTime?      @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime?      @map("updated_at") @db.Timestamp(6)
  product       Product        @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  optionChoices OptionChoice[]

  @@index([productId])
  @@map("option_groups")
  @@schema("public")
}

model OptionChoice {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  optionGroupId       String               @map("option_group_id") @db.Uuid
  name                String               @db.VarChar(255)
  priceModifier       Decimal              @default(0) @map("price_modifier") @db.Decimal(10, 2)
  createdAt           DateTime?            @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime?            @map("updated_at") @db.Timestamp(6)
  optionGroup         OptionGroup          @relation(fields: [optionGroupId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  orderProductOptions OrderProductOption[]

  @@map("option_choices")
  @@schema("public")
}

model Order {
  id            String         @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  restaurantId  String         @map("restaurant_id") @db.Uuid
  userId        String?        @map("user_id") @db.Uuid
  fullName      String?        @map("full_name") @db.VarChar(50)
  phone         String?        @db.VarChar(50)
  email         String?        @db.VarChar(50)
  status        OrderStatus    @default(PENDING)
  totalPrice    Decimal        @default(0) @map("total_price") @db.Decimal(10, 2)
  createdAt     DateTime?      @default(dbgenerated("(now() AT TIME ZONE 'utc'::text)")) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime?      @map("updated_at") @db.Timestamp(6)
  restaurant    Restaurant     @relation(fields: [restaurantId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  orderProducts OrderProduct[]

  @@index([restaurantId])
  @@map("orders")
  @@schema("public")
}

model OrderProduct {
  id                  String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderId             String               @map("order_id") @db.Uuid
  productId           String               @map("product_id") @db.Uuid
  quantity            Int
  order               Order                @relation(fields: [orderId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  product             Product              @relation(fields: [productId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  orderProductOptions OrderProductOption[]

  @@index([orderId])
  @@map("order_products")
  @@schema("public")
}

model OrderProductOption {
  id             String       @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  orderProductId String       @map("order_product_id") @db.Uuid
  optionChoiceId String       @map("option_choice_id") @db.Uuid
  orderProduct   OrderProduct @relation(fields: [orderProductId], references: [id], onDelete: Cascade, onUpdate: NoAction)
  optionChoice   OptionChoice @relation(fields: [optionChoiceId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([orderProductId])
  @@map("order_product_options")
  @@schema("public")
}

enum RestaurantRole {
  OWNER
  ADMIN
  STAFF

  @@map("restaurant_role")
  @@schema("public")
}

enum OrderStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  DELIVERED
  CANCELLED

  @@map("order_status")
  @@schema("public")
}
